# AGENTS.md — Project Control Surface (Linux)

```yaml
agents_doc: v1
updated_at: 2025-10-01T04:50:00Z
owners: [ "vibe-coder", "gpt-5-codex" ]
harness: { approvals: "never", sandbox: { fs: "danger-full-access", net: "enabled" } }
budgets: { p99_ms: 0, memory_mb: 0, bundle_kb: 0 }
stacks: { runtime: "bash@5", build: "agentcall@0.2" }
teach: true
```
## Command Quick Reference
- `agentcall init [PATH]` — развернуть проект, заполнить `config/commands.sh`, каркас roadmap/task board.
- `agentcall upgrade [PATH]` — обновить проект до версии шаблона CLI, пересобрать артефакты.
- `agentcall verify` — QA пайплайн (fmt/tests/coverage/security/architecture/Memory Heart) с отчётом в `reports/verify.json`.
- `agentcall fix` — выполняет безопасные автопочинки из `config/commands.sh`.
- `agentcall review` — diff-ревью + отчёт `reports/review.json`.
- `agentcall ship` — релиз-гейт (verify → ship choreography).
- `agentcall status` — агрегирует статус программы, эпиков, задач (`reports/status.json`).
- `agentcall agents <cmd>` — управление агентами (`auth`, `status`, `logs`, `workflow` и др.).
- `agentcall heart <cmd>` — операции Memory Heart (`sync`, `query`, `serve`).
- `agentcall doctor` — диагностика окружения (`reports/doctor.json`).
- `agentcall commands` — показать все зарегистрированные команды.
- `agentcall run <name> [args…]` — вызвать кастомный пайплайн из `agentcontrol/agentcall.yaml`.
- Скрипт `scripts/install_agentcontrol.sh` — залить шаблоны в `~/.agentcontrol/templates/` (однократно).
- `python3 scripts/sdk.py [...]` — тонкая обёртка для обратной совместимости.

## Agent Workflows
- Configuration resides in `config/agents.json`. Example:
```jsonc
{
  "workflows": {
    "default": {
      "assign_agent": "codex",
      "assign_role": "Implementation Lead",
      "review_agent": "claude",
      "review_role": "Staff Reviewer"
    }
  }
}
```
- Override on the fly via `ASSIGN_AGENT`, `ASSIGN_ROLE`, `REVIEW_AGENT`, `REVIEW_ROLE`.
- Logs for each agent run are written under `reports/agents/` together with execution metadata.

## Planning Model
- **Global plan:** Program → Epics → Big Tasks live in `todo.machine.md` and are regenerated by `agentcall progress` / `agentcall run architecture-sync`.
- **Micro tasks:** managed exclusively via the Update Plan Tool (UPT) inside Codex CLI; the queue must be empty for `agentcall ship`.
- **Task board:** persisted in `data/tasks.board.json`, `state/task_state.json`, and `journal/task_events.jsonl`.
- **Default agent:** `gpt-5-codex`, override per command through `AGENT` or workflow variables.

## Quality Gates
- Structural integrity: `AGENTS.md`, `todo.machine.md`, `.editorconfig`, `.codexignore`.
- Shell scripts: `shellcheck` when available.
- Custom commands from `config/commands.sh` (verify/fix/review/ship pipelines).
- Quality guard: secret/placeholder detection (warnings by default, promote to errors with `EXIT_ON_FAIL=1`).
- Reports: `reports/verify.json`, `reports/review.json`, `reports/status.json`, `reports/doctor.json`.
- Memory Heart freshness enforced via `scripts/agents/heart_check.sh` inside `agentcall verify`.
- Release guard: `agentcall ship` blocks on any failing gate or open micro tasks (UPT).

## Rollback & Recovery
- Feature toggles: environment variables `SDK_*_COMMANDS` in `config/commands.sh`.
- Emergency procedure: restore `config/commands.sh` from template and rerun `agentcall verify`.
- Task board reset: restore `data/tasks.board.json`, clear `state/task_selection.json`, archive `journal/task_events.jsonl`.
- Agent state: remove `state/agents/` or run `agentcall agents logout` to rebuild clean credentials.

## Reference Links
- Architectural manifest: `architecture/manifest.yaml`.
- ADRs: `docs/adr/`; RFCs: `docs/rfc/`.
- Architecture overview: `docs/architecture/overview.md`.
- Change log seed: `docs/changes.md`.
- Scripts: `scripts/`; Git hooks (if configured): `scripts/git-hooks/`.
- Roadmap sync automation: `scripts/sync-roadmap.sh`.
- Architecture sync automation: `scripts/sync-architecture.sh`.
- Agent binaries: `scripts/bin/` (populated by `agentcall agents install`).
- Status snapshots: `reports/status.json`, `reports/architecture-dashboard.json`.
- Agent auth state: `state/agents/auth_status.json`.
